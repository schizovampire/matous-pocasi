<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- CRITICAL: Ensure correct scaling on old devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>iOS 7 Weather Clone</title>
    <!-- Removed Tailwind CDN for maximum compatibility -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* BASE STYLES & FONT */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            color: white; 
            overflow: hidden; 
            font-family: 'Inter', sans-serif;
            transition: background 1s ease-in-out;
            background: linear-gradient(180deg, #2a2a72 0%, #009ffd 100%); /* Default SF gradient */
        }
        
        /* SIMPLIFIED TRANSLUCENCY (Performance Fix for iPhone 4) */
        .translucent-pane {
            /* Replaced taxing -webkit-backdrop-filter with simple translucent color */
            background-color: rgba(255, 255, 255, 0.15); 
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1); /* Lighter border for subtler look */
        }

        /* MAIN SCROLL CONTAINER (Using Old WebKit Box Model) */
        #weather-scroll-container {
            height: 100%;
            overflow-x: scroll;
            /* Box Model Setup */
            display: -webkit-box; 
            display: flex;
            -webkit-box-orient: horizontal;
            
            /* CSS snapping disabled as we rely on reliable JS snapping now */
            scroll-behavior: smooth;
        }

        /* CITY PAGE (Using Old WebKit Box Model for Layout) */
        .city-page {
            /* flex: 0 0 100vw; equivalent */
            -webkit-box-flex: 0; 
            width: 100vw;
            box-sizing: border-box; /* Necessary for padding */
            padding: 16px; /* 1rem */
            
            /* Internal vertical layout: display: flex; flex-direction: column; justify-content: space-between; */
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-box-pack: justify; 
            
            min-height: 100%; /* Ensure it fills the scroll container height */
        }
        
        /* UTILITY CLASSES (Mimicking essential styles) */
        .flex-col-center {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-box-align: center; /* items-center */
            padding-top: 32px; /* pt-8 */
            margin-bottom: 8px; /* space-y-2 */
        }

        .text-3xl { font-size: 30px; line-height: 1.2; }
        .text-xl { font-size: 20px; line-height: 1.2; }
        .text-lg { font-size: 18px; line-height: 1.2; }
        .text-sm { font-size: 14px; line-height: 1.2; }
        .font-light { font-weight: 300; }
        .font-medium { font-weight: 500; }
        .font-extralight { font-weight: 200; }
        .tracking-wide { letter-spacing: 0.025em; }

        /* MAIN TEMPERATURE STYLING */
        .temp-main {
            font-weight: 100; /* Extra thin look */
            font-size: 130px; 
            line-height: 110px; /* Reduced line-height to keep it tight */
        }
        
        /* HOURLY & DAILY FORECAST LAYOUTS */
        .hourly-scroll {
            display: -webkit-box;
            overflow-x: scroll;
            padding: 8px 0; /* py-2 */
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 12px; /* mb-3 */
            text-align: center;
        }

        .hourly-item {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-box-align: center;
            width: 60px; /* fixed width */
            margin-right: 24px; /* space-x-6 */
            -webkit-box-flex: 0; /* flex-shrink-0 */
        }
        
        .daily-item {
            display: -webkit-box;
            -webkit-box-pack: justify; /* justify-between */
            -webkit-box-align: center; /* items-center */
            padding: 8px 0;
        }
        
        /* Bottom Nav Bar */
        .bottom-nav-fixed {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 64px; /* h-16 */
            padding: 0 16px; /* px-4 */
            
            /* Layout */
            display: -webkit-box;
            -webkit-box-pack: justify; 
            -webkit-box-align: center; 
            
            /* Translucent style override */
            background-color: rgba(255, 255, 255, 0.15); 
            border: none; 
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0;
        }

        .dot-indicator-container {
             display: -webkit-box;
             margin-left: 8px; /* space-x-2 */
        }

        .dot {
             width: 8px; height: 8px;
             border-radius: 50%;
             background-color: rgba(255, 255, 255, 0.4);
             margin: 0 4px; /* Space between dots */
             -webkit-transition: all 0.3s ease-in-out;
             transition: all 0.3s ease-in-out;
        }

        .dot.active {
            background-color: white;
        }

    </style>
</head>
<body>

    <!-- Global Wrapper for Scroll Snap -->
    <div id="weather-scroll-container">
        <!-- City pages will be generated and content inserted here -->
    </div>

    <script>
        // All variables are converted to 'var' for ES5 compatibility
        var weatherData = [
            {
                city: "San Francisco",
                temp: "41Â°",
                condition: "Clear",
                highLow: "H:46Â° L:38Â°",
                summary: "Mostly clear conditions will continue throughout the night.",
                gradient: "linear-gradient(180deg, #2a2a72 0%, #009ffd 100%)", // Night Blue
                hourly: [
                    { time: "Now", icon: "ğŸŒ™", temp: "41Â°" },
                    { time: "1 AM", icon: "ğŸŒ™", temp: "40Â°" },
                    { time: "2 AM", icon: "â˜ï¸", temp: "39Â°" },
                    { time: "3 AM", icon: "â˜ï¸", temp: "39Â°" },
                    { time: "4 AM", icon: "â˜ï¸", temp: "39Â°" },
                    { time: "5 AM", icon: "ğŸŒ§ï¸", temp: "38Â°" },
                    { time: "6 AM", icon: "ğŸŒ§ï¸", temp: "39Â°" },
                    { time: "7 AM", icon: "ğŸŒ¤ï¸", temp: "41Â°" }
                ],
                daily: [
                    { day: "Today", icon: "ğŸŒ™", low: "38Â°", high: "46Â°" },
                    { day: "FRI", icon: "ğŸŒ¤ï¸", low: "39Â°", high: "51Â°" },
                    { day: "SAT", icon: "â˜€ï¸", low: "40Â°", high: "55Â°" }
                ]
            },
            {
                city: "New York",
                temp: "34Â°",
                condition: "Cloudy",
                highLow: "H:37Â° L:30Â°",
                summary: "It will remain overcast with a chance of light snow late tonight.",
                gradient: "linear-gradient(180deg, #5c6770 0%, #a4b4c4 100%)", // Cloudy Gray
                hourly: [
                    { time: "Now", icon: "â˜ï¸", temp: "34Â°" },
                    { time: "1 AM", icon: "â˜ï¸", temp: "32Â°" },
                    { time: "2 AM", icon: "â„ï¸", temp: "30Â°" },
                    { time: "3 AM", icon: "â„ï¸", temp: "30Â°" },
                    { time: "4 AM", icon: "â„ï¸", temp: "31Â°" },
                    { time: "5 AM", icon: "â˜ï¸", temp: "32Â°" },
                    { time: "6 AM", icon: "ğŸŒ¤ï¸", temp: "33Â°" },
                    { time: "7 AM", icon: "â˜€ï¸", temp: "35Â°" }
                ],
                daily: [
                    { day: "Today", icon: "â˜ï¸", low: "30Â°", high: "37Â°" },
                    { day: "FRI", icon: "â˜€ï¸", low: "31Â°", high: "45Â°" },
                    { day: "SAT", icon: "â˜€ï¸", low: "35Â°", high: "50Â°" }
                ]
            },
            {
                city: "Tokyo",
                temp: "15Â°",
                condition: "Rainy",
                highLow: "H:18Â° L:12Â°",
                summary: "Steady rain expected to last through the morning hours.",
                gradient: "linear-gradient(180deg, #1f4068 0%, #162447 100%)", // Dark Rainy Blue
                hourly: [
                    { time: "Now", icon: "ğŸŒ§ï¸", temp: "15Â°" },
                    { time: "1 PM", icon: "ğŸŒ§ï¸", temp: "14Â°" },
                    { time: "2 PM", icon: "ğŸŒ§ï¸", temp: "14Â°" },
                    { time: "3 PM", icon: "ğŸŒ§ï¸", temp: "15Â°" },
                    { time: "4 PM", icon: "â›ˆï¸", temp: "16Â°" },
                    { time: "5 PM", icon: "â›ˆï¸", temp: "17Â°" },
                    { time: "6 PM", icon: "â˜”", temp: "18Â°" },
                    { time: "7 PM", icon: "â˜”", temp: "16Â°" }
                ],
                daily: [
                    { day: "Today", icon: "ğŸŒ§ï¸", low: "12Â°", high: "18Â°" },
                    { day: "FRI", icon: "â˜ï¸", low: "14Â°", high: "22Â°" },
                    { day: "SAT", icon: "ğŸŒ¤ï¸", low: "15Â°", high: "25Â°" }
                ]
            },
            {
                city: "MatouÅ¡",
                temp: "135Â°",
                condition: "MatouÅ¡",
                highLow: "H:142Â° L:129Â°",
                summary: "MatouÅ¡ MatouÅ¡ MatouÅ¡ MatouÅ¡ MatouÅ¡ MatouÅ¡ MatouÅ¡ MatouÅ¡.",
                gradient: "linear-gradient(180deg, #8B0000 0%, #FF4500 100%)", // Dark Red / Orange for heat
                hourly: [
                    { time: "MatouÅ¡", icon: "ğŸ”¥", temp: "135Â°" },
                    { time: "MatouÅ¡", icon: "ğŸ”¥", temp: "138Â°" },
                    { time: "MatouÅ¡", icon: "â˜€ï¸", temp: "140Â°" },
                    { time: "MatouÅ¡", icon: "â˜€ï¸", temp: "142Â°" },
                    { time: "MatouÅ¡", icon: "ğŸ”¥", temp: "139Â°" },
                    { time: "MatouÅ¡", icon: "â˜€ï¸", temp: "137Â°" },
                    { time: "MatouÅ¡", icon: "ğŸ”¥", temp: "135Â°" },
                    { time: "MatouÅ¡", icon: "â˜€ï¸", temp: "133Â°" }
                ],
                daily: [
                    { day: "MatouÅ¡", icon: "ğŸ”¥", low: "129Â°", high: "142Â°" },
                    { day: "MatouÅ¡", icon: "â˜€ï¸", low: "130Â°", high: "145Â°" },
                    { day: "MatouÅ¡", icon: "ğŸ”¥", low: "135Â°", high: "141Â°" }
                ]
            }
        ];

        var scrollContainer = document.getElementById('weather-scroll-container');
        var body = document.body;
        var pageIndicator; 
        var numCities = weatherData.length;
        var bottomNavHtml;


        // --- Helper Functions ---

        /**
         * Generates the HTML content for a single city's weather view.
         */
        function generateCityContent(data) {
            // Using .map() and standard function, then joining via string concatenation
            var hourlyHtml = data.hourly.map(function(item) {
                return '<div class="hourly-item">' +
                       '<span class="font-light text-sm">' + item.time + '</span>' +
                       '<span class="text-2xl" style="padding-top: 4px;">' + item.icon + '</span>' +
                       '<span class="font-light text-xl" style="padding-top: 4px;">' + item.temp + '</span>' +
                       '</div>';
            }).join('');

            var dailyHtml = data.daily.map(function(item) {
                return '<div class="daily-item text-lg">' +
                       '<span class="font-light" style="width: 25%;">' + item.day + '</span>' +
                       '<span class="text-2xl" style="width: 25%; text-align: center;">' + item.icon + '</span>' +
                       '<span class="font-light" style="width: 25%; text-align: left;">' + item.low + '</span>' +
                       '<span class="font-medium" style="width: 25%; text-align: right;">' + item.high + '</span>' +
                       '</div>';
            }).join('');

            // Full content block using string concatenation and custom CSS classes
            return (
                '<!-- Top Section: City and Current Temp -->' +
                '<div class="flex-col-center">' +
                    '<div class="text-3xl font-light tracking-wide">' + data.city + '</div>' +
                    '<div class="temp-main">' + data.temp + '</div>' +
                    '<div class="text-xl font-medium">' + data.condition + '</div>' +
                    '<!-- High/Low Today -->' +
                    '<div class="text-lg font-normal" style="padding-top: 16px;">' +
                        data.highLow +
                    '</div>' +
                '</div>' +

                '<!-- Scrollable Forecast Section (The translucent card) -->' +
                '<div style="min-height: 0; -webkit-box-flex: 1; display: -webkit-box; -webkit-box-align: end;">' +
                    // Note: Changed class name to translucent-pane for clarity, using simpler CSS
                    '<div class="translucent-pane" style="width: 100%; padding: 16px; margin-bottom: 8px;">' +
                        
                        '<!-- Today\'s Summary Line -->' +
                        '<div class="text-sm font-light" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 12px; margin-bottom: 12px;">' +
                            '<p>' + data.summary + '</p>' +
                        '</div>' +

                        '<!-- Hourly Forecast (Horizontal Scroll) -->' +
                        '<div class="hourly-scroll">' +
                            hourlyHtml +
                        '</div>' +

                        '<!-- Daily Forecast (Stacked) -->' +
                        '<div style="margin-top: 16px;">' +
                            dailyHtml +
                        '</div>' +

                    '</div>' +
                '</div>'
            );
        }

        /**
         * Renders all city pages and their data, and injects the fixed bottom navigation.
         */
        function renderCityPages() {
            var container = document.getElementById('weather-scroll-container');
            container.innerHTML = ''; 

            for (var index = 0; index < weatherData.length; index++) {
                var data = weatherData[index];
                var cityPage = document.createElement('div');
                cityPage.id = 'city-' + index;
                cityPage.className = 'city-page';
                cityPage.innerHTML = generateCityContent(data);
                container.appendChild(cityPage);
            }
            
            // Fixed navigation bar HTML - using custom CSS class
            bottomNavHtml = 
                '<div id="bottom-nav" class="bottom-nav-fixed">' +
                    '<!-- Details Button (Mock) -->' +
                    '<button class="text-2xl font-extralight" style="opacity: 0.8; border: none; background: transparent; color: inherit; padding: 0;">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M17 12H17.01"/><path d="M12 12H12.01"/><path d="M7 12H7.01"/></svg>' +
                    '</button>' +
                    
                    '<!-- Page Indicator (Dynamic Dots) -->' +
                    '<div id="page-indicator-new" class="dot-indicator-container">' +
                        '<!-- Dots will be generated here by JS -->' +
                    '</div>' +

                    '<!-- List Button (Mock) -->' +
                    '<button class="text-2xl font-extralight" style="opacity: 0.8; border: none; background: transparent; color: inherit; padding: 0;">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>' +
                    '</button>' +
                '</div>';
            
            var existingNav = document.getElementById('bottom-nav');
            if (existingNav) {
                existingNav.parentNode.removeChild(existingNav);
            }
            document.body.insertAdjacentHTML('beforeend', bottomNavHtml);
            
            // Update the global pageIndicator reference
            pageIndicator = document.getElementById('page-indicator-new');
        }

        /**
         * Updates the background gradient and dot indicator based on the current city.
         * @param {number} cityIndex
         */
        function updateUI(cityIndex) {
            var data = weatherData[cityIndex];
            if (!pageIndicator) return; 

            var indicators = pageIndicator.children;

            // 1. Update Background Gradient
            body.style.background = data.gradient;

            // 2. Update Page Indicators
            for (var i = 0; i < indicators.length; i++) {
                if (i === cityIndex) {
                    // Current page: solid white dot
                    indicators[i].className = 'dot active';
                } else {
                    // Other pages: translucent white dot
                    indicators[i].className = 'dot';
                }
            }
        }

        /**
         * Sets up the initial page indicators (dots)
         */
        function setupPageIndicators() {
            // Clear existing dots if any
            pageIndicator.innerHTML = '';
            for (var i = 0; i < numCities; i++) {
                var dot = document.createElement('div');
                dot.className = 'dot'; 
                pageIndicator.appendChild(dot);
            }
        }

        // --- Event Listener for Snapping (JS-based) ---

        var scrollTimeout;
        // Listen for the scroll event
        scrollContainer.addEventListener('scroll', function() {
            // Clear any previous timeout
            clearTimeout(scrollTimeout);
            
            // Set a timeout to run after scrolling stops (150ms should cover scroll inertia)
            scrollTimeout = setTimeout(function() {
                // SCROLL HAS STOPPED. NOW WE EXECUTE THE SNAP AND UPDATE UI.
                
                var scrollLeft = scrollContainer.scrollLeft;
                var clientWidth = scrollContainer.clientWidth;
                
                // 1. Calculate the position ratio
                var scrollRatio = scrollLeft / clientWidth;
                
                // 2. Adjust for 25% sensitivity: A displacement of 25% or more snaps to the next page.
                // We add a 0.25 bias (1/4 of a page width) to the ratio before rounding down (Math.floor).
                var biasedRatio = scrollRatio + 0.25; 
                
                // Math.floor(biasedRatio) is equivalent to rounding down to the integer page index.
                var currentPage = Math.floor(biasedRatio);
                
                // 3. Ensure index is within bounds
                currentPage = Math.min(numCities - 1, Math.max(0, currentPage));
                
                // 4. Calculate the target scroll position (the start of the nearest page)
                var targetPosition = currentPage * clientWidth;
                
                // 5. Force the scroll position to snap to the target position
                scrollContainer.scrollLeft = targetPosition; 

                // 6. Update the UI
                updateUI(currentPage);
                
            }, 150); 
        });

        // --- Initialization ---
        window.onload = function() {
            renderCityPages();
            setupPageIndicators();
            // Initial update for the first city (index 0)
            updateUI(0);
        };

    </script>
</body>
</html>
